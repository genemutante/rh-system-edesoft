<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gest√£o de Certifica√ß√µes | Academy</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #4f46e5; 
            --primary-hover: #4338ca; 
            --border: #e2e8f0; 
            --bg: #f8fafc; 
            --text-main: #0f172a; 
            --text-muted: #64748b;
            --white: #ffffff;
            --view-blue: #2563eb;
            --edit-purple: #7c3aed;
            --delete-red: #dc2626;
        }

        * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { margin: 0; background-color: var(--bg); color: var(--text-main); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        .app-header { height: 56px; background: var(--white); border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 24px; justify-content: space-between; flex-shrink: 0; }
        .header-title { font-size: 16px; font-weight: 800; color: var(--primary); letter-spacing: -0.02em; }

        #view-lista { flex: 1; display: flex; flex-direction: column; overflow: hidden; animation: fadeIn 0.2s ease; }

        /* FILTROS */
.filter-bar {
    background: var(--white);
    padding: 12px 24px;
    border-bottom: 1px solid var(--border);
    display: flex;
    gap: 12px;
    align-items: flex-end;
    max-width: 720px; /* aprox. 50% da tela em desktops */
    margin-top: 8px;
    margin-left: 24px;
    flex-wrap: wrap;
}

.filter-group {
    display: flex;
    flex-direction: column;
    gap: 4px;
    flex: 1 1 220px;
    min-width: 200px;
    max-width: 100%;
}

.search-input,
.filter-select {
    height: 36px;
    padding: 0 10px;
    border: 1px solid var(--border);
    border-radius: 6px;
    font-size: 14px;
    background: #f1f5f9;
}


        /* TABELA */
        .table-container { flex: 1; overflow: auto; padding: 16px 24px; }
        table { width: 100%; border-collapse: separate; border-spacing: 0; background: var(--white); border-radius: 8px; border: 1px solid var(--border); }
        th { background: #f8fafc; text-align: left; padding: 10px 12px; font-size: 10px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; border-bottom: 1px solid var(--border); }
        td { padding: 6px 12px; border-bottom: 1px solid #f1f5f9; font-size: 13px; line-height: 1.2; }
        tr:hover td { background: #fcfdfe; }

        /* A√á√ïES SEM QUEBRA */
        .actions-cell {
            display: flex;
            justify-content: flex-end;
            gap: 4px;
            white-space: nowrap;
            min-width: 110px;
        }

        .btn-action {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            border: 1px solid transparent;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            transition: 0.2s;
        }

        .btn-view { background: #eff6ff; color: var(--view-blue); border-color: #dbeafe; }
        .btn-view:hover { background: var(--view-blue); color: white; }

        .btn-edit { background: #f5f3ff; color: var(--edit-purple); border-color: #ede9fe; }
        .btn-edit:hover { background: var(--edit-purple); color: white; }

        .btn-delete { background: #fef2f2; color: var(--delete-red); border-color: #fee2e2; }
        .btn-delete:hover { background: var(--delete-red); color: white; }

        .btn { height: 36px; padding: 0 16px; border-radius: 6px; font-weight: 700; cursor: pointer; border: none; font-size: 12px; display: inline-flex; align-items: center; gap: 6px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-outline { background: white; border: 1px solid var(--border); color: var(--text-muted); }

        .badge { padding: 3px 6px; border-radius: 4px; font-size: 9px; font-weight: 800; }
        .type-cert { background: #e0e7ff; color: #4338ca; }
        .type-notorio { background: #fef3c7; color: #92400e; }

        .admin-only { display: none; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>

<body>

<header class="app-header">
    <div class="header-title">ACADEMY // GEST√ÉO DE CERTIFICA√á√ïES</div>
    <button class="btn btn-primary admin-only" id="btnTopNovo" onclick="window.abrirFormulario()">‚ûï NOVO REGISTRO</button>
</header>

<div id="view-lista">

    <div class="filter-bar">
        <div class="filter-group">
            <label>Pesquisar Colaborador ou Curso</label>
            <input type="text" id="searchBox" class="search-input" placeholder="Buscar colaborador ou curso..." onkeyup="window.filtrar()">
        </div>

        <div class="filter-group" style="flex:0">
            <label>Tipo</label>
            <select id="filterTipo" class="filter-select" onchange="window.filtrar()">
                <option value="TODOS">Todos</option>
                <option value="CERTIFICADO">Certificados</option>
                <option value="NOTORIO">Not√≥rio Saber</option>
            </select>
        </div>

        <button class="btn btn-outline" onclick="window.limparFiltros()">LIMPAR</button>
    </div>

    <div class="table-container">
        <table id="homologTable">
            <thead>
                <tr>
                    <th>Colaborador</th>
                    <th>Compet√™ncia</th>
                    <th>Tipo</th>
                    <th>Data</th>
                    <th>Nota</th>
                    <th style="text-align:right">A√ß√µes</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script type="module">
import { DBHandler } from '../bd-treinamentos/db-handler.js';

let DADOS_LISTA = [];

window.carregarLista = async () => {
    DADOS_LISTA = await DBHandler.listarHomologacoes();
    renderizarTabela(DADOS_LISTA);
};

function renderizarTabela(lista) {
    const tbody = document.querySelector("#homologTable tbody");
    const session = JSON.parse(localStorage.getItem('rh_session'));

    tbody.innerHTML = lista.map(item => `
        <tr>
            <td><strong>${item.colaboradores?.nome || '‚Äî'}</strong></td>
            <td>${item.treinamentos?.nome || '‚Äî'}</td>
            <td><span class="badge ${item.atividade_externa === 'NOTORIO' ? 'type-notorio' : 'type-cert'}">${item.atividade_externa || 'CERTIFICADO'}</span></td>
            <td>${item.data_homologacao ? new Date(item.data_homologacao).toLocaleDateString('pt-BR') : '‚Äî'}</td>
            <td>${item.nota || 'N/A'}</td>
            <td class="actions-cell">
                <button class="btn-action btn-view" onclick="window.abrirFormulario(${item.id}, true)">üëÅÔ∏è</button>
                ${session.role === 'ADMIN' ? `
                    <button class="btn-action btn-edit" onclick="window.abrirFormulario(${item.id}, false)">‚úèÔ∏è</button>
                    <button class="btn-action btn-delete" onclick="window.deletarRegistro(${item.id})">üóëÔ∏è</button>
                ` : ''}
            </td>
        </tr>
    `).join('');
}

window.filtrar = () => {
    const busca = document.getElementById('searchBox').value.toLowerCase();
    const tipo = document.getElementById('filterTipo').value;

    renderizarTabela(DADOS_LISTA.filter(i =>
        ((i.colaboradores?.nome || "").toLowerCase().includes(busca) ||
         (i.treinamentos?.nome || "").toLowerCase().includes(busca)) &&
        (tipo === 'TODOS' || i.atividade_externa === tipo)
    ));
};

window.limparFiltros = () => {
    searchBox.value = "";
    filterTipo.value = "TODOS";
    renderizarTabela(DADOS_LISTA);
};

window.carregarLista();
</script>

</body>
</html>

