<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Edesoft Academy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="../estilos-treinamentos/catalogo-style.css">

  <!-- ✅ OVERRIDES CIRÚRGICOS (PRECISAM FICAR DEPOIS DO CSS PRINCIPAL) -->
  <style>
    /* ------------------------------------------------------------
       Toolbar: checkbox "Mostrar Ocultos" sem brigar com label absoluto
    ------------------------------------------------------------ */
    .checkbox-wrapper{
      display:flex !important;
      flex-direction:row !important;
      align-items:center !important;
      gap:8px !important;
      padding-top:10px !important;
    }
    .checkbox-wrapper label{
      position:static !important;
      top:auto !important;
      left:auto !important;
      transform:none !important;
      font-size:.85rem !important;
      font-weight:700 !important;
      color:#64748b !important;
      text-transform:none !important;
      letter-spacing:0 !important;
      pointer-events:auto !important;
    }
    .checkbox-wrapper input[type="checkbox"]{
      width:18px !important;
      height:18px !important;
      cursor:pointer !important;
    }

    /* ------------------------------------------------------------
       Modal CURSO: largura/altura maior + compactação vertical
       (aplica porque você adicionou .modal-curso-wide no HTML)
    ------------------------------------------------------------ */
    #modal-curso .modal-content.modal-curso-wide{
      width: min(1380px, 96vw) !important;   /* mais largo */
      max-width: none !important;
      max-height: 92vh !important;          /* mais alto */
      border-radius: 16px !important;
    }

    #modal-curso .modal-header{
      padding: 10px 18px !important;
      min-height: 52px !important;
    }
    #modal-curso .modal-header h2{
      font-size: 1.05rem !important;
    }

    #modal-curso .modal-body{
      padding: 14px 18px !important;
      gap: 10px !important;
      overflow: hidden !important; /* evita scrollbar no modal */
    }

    #modal-curso .modal-footer{
      padding: 10px 18px !important;
      gap: 10px !important;
    }

    /* ------------------------------------------------------------
       ✅ TOPO EM GRID (Nome / Status / Descrição / Exibir) + trilha/subtrilha
       Agora funciona porque existe .curso-topo-grid e .form-row-trilhas
    ------------------------------------------------------------ */
    .curso-topo-grid{
      display:grid !important;
      grid-template-columns: 2.2fr 1.1fr 2.2fr auto !important;
      grid-auto-rows: auto !important;
      gap: 10px 12px !important;
      align-items: end !important;
      margin-bottom: 10px !important;
    }

    /* Linha 2 dentro do topo (Trilha/Subtrilha) ocupa a linha de baixo */
    .curso-topo-grid .form-row-trilhas{
      grid-column: 1 / -1 !important;
      display:grid !important;
      grid-template-columns: 1.2fr 1fr !important; /* Trilha | Subtrilha */
      gap: 12px !important;
      align-items: end !important;
      margin-top: 2px !important;
    }

    /* Deixa os form-group sem “respiro” extra */
    #modal-curso .form-group{
      margin-bottom: 0 !important;
    }
    #modal-curso .form-group label{
      margin-bottom: 3px !important;
      font-size: .75rem !important;
      font-weight: 700 !important;
      letter-spacing: .04em !important;
      text-transform: uppercase !important;
    }

    /* Inputs mais “slim” (mantém seu padrão) */
    #modal-curso .input-premium,
    #modal-curso textarea.input-premium,
    #modal-curso .select-wrapper select{
      padding: 7px 10px !important;
      font-size: .85rem !important;
    }

    /* Descrição: não engolir altura */
    #modal-curso #curso-descricao{
      resize: none !important;
      max-height: 58px !important;
      overflow: auto !important;
      line-height: 1.25 !important;
    }

    /* Toggle “Exibir?” alinhado e compacto */
    #modal-curso .toggle-wrapper{
      height: auto !important;
      min-height: unset !important;
      display:flex !important;
      flex-direction:column !important;
      justify-content:flex-end !important;
      align-items:center !important;
      padding-bottom: 2px !important;
    }

    /* ------------------------------------------------------------
       Origem das aulas: menos altura e mais “premium”
    ------------------------------------------------------------ */
    #modal-curso .source-selector{
      padding: 3px !important;
      gap: 8px !important;
      border-radius: 10px !important;
      margin-bottom: 10px !important;
    }
    #modal-curso .radio-option label{
      padding: 7px 10px !important;
      font-size: .82rem !important;
    }

    /* Painel YouTube mais compacto */
    #modal-curso .youtube-wrapper{
      padding: 10px 12px !important;
      gap: 6px !important;
    }
    #modal-curso .youtube-help-text{
      margin-top: 0 !important;
    }
    #modal-curso .btn-youtube-sync{
      height: 34px !important;
      padding: 0 12px !important;
    }

    /* Metadata mais fina */
    #modal-curso .sync-metadata{
      padding: 4px 10px !important;
      font-size: .74rem !important;
    }

    /* Preview manual: se precisar rolar, rola só aqui */
    #modal-curso #lista-manual-preview{
      max-height: 120px !important;
      overflow-y: auto !important;
    }

    /* ------------------------------------------------------------
       Responsivo: em telas menores, quebra o grid do topo
    ------------------------------------------------------------ */
    @media (max-width: 980px){
      .curso-topo-grid{
        grid-template-columns: 1fr 1fr !important;
      }
      /* Exibir? vai para a próxima linha automaticamente */
      .curso-topo-grid .form-row-trilhas{
        grid-template-columns: 1fr !important;
      }
    }
  </style>

  <script type="module" src="../bd-treinamentos/db-handler.js"></script>
  <script type="module" src="../scripts-treinamentos/catalogo.js"></script>
</head>

<body>
  <div class="page">

    <section class="app-header">
      <div class="header-top">
        <p class="header-desc"></p>
      </div>


      
      <div class="toolbar">
        <div class="toolbar-filters">

            <div class="form-group" style="grid-column: 3;">
              <label>Descrição</label>
              <textarea id="curso-descricao" class="input-premium" rows="2" placeholder="Resumo do conteúdo do curso..."></textarea>
            </div>
          
          <div class="select-wrapper">
            <label>Trilha</label>
            <select id="filtro-trilha">
              <option value="">Todas</option>
            </select>
          </div>

          <div class="select-wrapper">
            <label>Subtrilha</label>
            <select id="filtro-subtrilha">
              <option value="">Todas</option>
            </select>
          </div>

          <!-- Wrapper separado para não brigar com o label absoluto do .select-wrapper -->
          <div class="select-wrapper checkbox-wrapper">
            <input type="checkbox" id="filtro-ver-ocultos">
            <label for="filtro-ver-ocultos">
              Mostrar Ocultos
            </label>
          </div>

          <div class="select-wrapper">
            <label>Status</label>
            <select id="filtro-status">
              <option value="">Todos</option>
              <option value="DISPONÍVEL">Disponível</option>
              <option value="EM DESENVOLVIMENTO">Em Desenv.</option>
              <option value="BACKLOG">Backlog</option>
            </select>
          </div>

          <div class="toolbar-search">
            <svg class="search-icon" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <input type="text" id="filtro-busca" placeholder="Buscar por título ou palavra-chave...">
          </div>

          <button class="btn-reset" id="btn-limpar-filtros" title="Limpar Filtros">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 6h18" />
              <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
              <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
              <line x1="10" x2="10" y1="11" y2="17" />
              <line x1="14" x2="14" y1="11" y2="17" />
            </svg>
          </button>
        </div>

        <div class="toolbar-actions" style="margin-left: auto; display: flex; gap: 10px;">
          <button id="btn-novo-curso" class="btn-primary-full"
            style="display: flex; align-items: center; gap: 8px; width: auto; background-color: #0f172a; color: white; border: none; padding: 0 16px; border-radius: 99px; cursor: pointer;">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" x2="12" y1="5" y2="19" />
              <line x1="5" x2="19" y1="12" y2="12" />
            </svg>
            Novo Curso
          </button>
        </div>
      </div>
    </section>

    <section class="resumo">
      <div class="card-metric">
        <div class="metric-icon icon-purple">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3.063 6.253M12 6.253V4.167h-1" />
          </svg>
        </div>
        <div class="metric-content">
          <span class="metric-value" id="resumo-total">0</span>
          <span class="metric-label">Total Cursos</span>
        </div>
      </div>

      <div class="card-metric">
        <div class="metric-icon icon-green">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <div class="metric-content">
          <span class="metric-value text-green" id="resumo-disponivel">0</span>
          <span class="metric-label">Total Disponível</span>
        </div>
      </div>

      <div class="card-metric">
        <div class="metric-icon icon-blue">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
          </svg>
        </div>
        <div class="metric-content">
          <span class="metric-value text-blue" id="resumo-em-dev">0</span>
          <span class="metric-label">Total em Dev.</span>
        </div>
      </div>

      <div class="card-metric">
        <div class="metric-icon icon-orange">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <div class="metric-content">
          <span class="metric-value text-orange" id="resumo-backlog">0</span>
          <span class="metric-label">Total Backlog</span>
        </div>
      </div>

      <div class="card-metric">
        <div class="metric-icon icon-cyan">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
        </div>
        <div class="metric-content">
          <span class="metric-value" id="resumo-horas">0h</span>
          <span class="metric-label">Carga Horária</span>
        </div>
      </div>

      <div class="card-metric">
        <div class="metric-icon icon-gray">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20" />
          </svg>
        </div>
        <div class="metric-content">
          <span class="metric-value" id="resumo-total-aulas">0</span>
          <span class="metric-label">Total de Aulas</span>
        </div>
      </div>
    </section>

    <section id="lista-cursos" class="lista-cursos"></section>

    <footer class="page-footer">
      &copy; 2025 Edesoft. Todos os direitos reservados.
    </footer>
  </div>

  <!-- MODAL LISTA AULAS -->
  <div id="modal-lista-aulas" class="modal-overlay" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h2 id="modal-titulo-curso">Grade Curricular</h2>
        <button class="btn-close-modal-aulas btn-close-modal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="curso-meta-info">
          <span id="modal-qtd-aulas" class="badge-info">0 aulas</span>
          <span id="modal-tempo-total" class="badge-info">0 min</span>
        </div>
        <ul id="lista-aulas-container" class="lista-aulas-premium"></ul>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary-full btn-close-modal-aulas">Fechar</button>
      </div>
    </div>
  </div>

  <!-- MODAL CURSO -->
  <div id="modal-curso" class="modal-overlay" style="display: none;">
    <div class="modal-content modal-curso-wide">
      <div class="modal-header">
        <h2 id="modal-curso-titulo">Novo Curso</h2>
        <button class="btn-close-modal-curso btn-close-modal">&times;</button>
      </div>

      <div class="modal-body">
        <form id="form-curso">
          <input type="hidden" id="curso-id">

          <!-- ✅ TOPO EM GRID -->
          <div class="curso-topo-grid">
            <!-- Linha 1 -->
            <div class="form-group" style="grid-column: 1;">
              <label>Nome do Curso</label>
              <input type="text" id="curso-nome" class="input-premium" required placeholder="Ex: Liderança Ágil" autocomplete="off">
            </div>

            <div class="form-group" style="grid-column: 2;">
              <label>Status</label>
              <select id="curso-status" class="input-premium">
                <option value="DISPONÍVEL">Disponível</option>
                <option value="EM DESENVOLVIMENTO">Em Desenv.</option>
                <option value="BACKLOG">Backlog</option>
              </select>
            </div>

            <div class="form-group toggle-wrapper" style="grid-column: 4;">
              <label style="font-size: 0.75rem; color: #64748b;">Exibir?</label>
              <label class="switch">
                <input type="checkbox" id="curso-exibir" checked>
                <span class="slider round"></span>
              </label>
            </div>

            <!-- Linha 2 (Trilha / Subtrilha) -->
            <div class="form-row-trilhas">
              <div class="form-group" style="flex: 1;">
                <label>Trilha</label>
                <div style="display: flex; gap: 8px; align-items: center;">
                  <div class="select-wrapper" style="flex: 1;" id="box-select-trilha">
                    <select id="curso-trilha-select" class="input-premium"></select>
                  </div>

                  <input type="text" id="curso-trilha-input" class="input-premium" style="display: none; flex: 1;" placeholder="Nova trilha...">

                  <button type="button" id="btn-toggle-trilha" class="btn-icon-editar" title="Criar/Selecionar" style="border-radius: 8px; flex-shrink: 0;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <line x1="12" x2="12" y1="5" y2="19"></line>
                      <line x1="5" x2="19" y1="12" y2="12"></line>
                    </svg>
                  </button>
                </div>
              </div>

              <div class="form-group" style="flex: 1;">
                <label>Subtrilha</label>
                <input type="text" id="curso-subtrilha" class="input-premium" placeholder="Ex: Vendas">
              </div>
            </div>
          </div>



          
          <div class="form-group">
            <label style="margin-bottom: 8px;">Origem das Aulas</label>

            <div class="source-selector">
              <div class="radio-option">
                <input type="radio" name="fonte_aulas" id="fonte_youtube" value="youtube" checked onchange="alternarFonte(this.value)">
                <label for="fonte_youtube">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                      d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  Playlist YouTube
                </label>
              </div>

              <div class="radio-option">
                <input type="radio" name="fonte_aulas" id="fonte_manual" value="manual" onchange="alternarFonte(this.value)">
                <label for="fonte_manual">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                      d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                  </svg>
                  Manual / Individual
                </label>
              </div>
            </div>

            <div id="panel-youtube" style="display: block;">
              <div class="youtube-wrapper">
                <div style="display: flex; gap: 8px;">
                  <input type="url" id="curso-link" class="input-premium" placeholder="Cole a URL da playlist aqui..." style="flex: 1;">
                  <button type="button" id="btn-sync-youtube-rapido" class="btn-youtube-sync" title="Buscar dados">
                    <span style="font-size: 0.85rem; font-weight: 600;">Sincronizar</span>
                  </button>
                </div>
                <small class="youtube-help-text">
                  O sistema substituirá as aulas atuais pelas da playlist.
                </small>
              </div>
            </div>

            <div id="panel-manual" style="display: none;">
              <div class="manual-wrapper">
                <div class="manual-input-row">
                  <input type="text" id="manual-titulo" class="input-premium" placeholder="Título da Aula" style="flex: 3;">
                  <input type="number" id="manual-minutos" class="input-premium" placeholder="Min" style="width: 70px;">
                </div>
                <div class="manual-input-row" style="margin-top: 8px;">
                  <input type="url" id="manual-link" class="input-premium" placeholder="Link do Vídeo (Opcional)" style="flex: 1;">
                  <button type="button" id="btn-add-manual" class="btn-add-manual">
                    + Adicionar Aula
                  </button>
                </div>
              </div>
            </div>

            <div style="margin-top: 0px;">
              <div class="sync-metadata" id="box-metadata-sync">
                <div class="meta-item">
                  <span class="meta-label">Aulas:</span>
                  <span class="meta-value" id="meta-qtd-aulas">0</span>
                </div>
                <div style="width: 1px; height: 12px; background: #cbd5e1;"></div>
                <div class="meta-item">
                  <span class="meta-label">Tempo:</span>
                  <span class="meta-value" id="meta-tempo-total">0 min</span>
                </div>
                <div style="width: 1px; height: 12px; background: #cbd5e1;"></div>
                <div class="meta-item" style="flex: 1;">
                  <span class="meta-label">Sync:</span>
                  <span class="meta-value" id="meta-data-sync">Nunca</span>
                </div>

                <div class="meta-badge-pendente" id="badge-pendente" style="display: none;">
                  Pendentes
                </div>

                <button type="button" id="btn-limpar-aulas"
                  style="margin-left: auto; font-size: 0.75rem; color: #ef4444; background: none; border: none; cursor: pointer; display: none; font-weight: 600;">
                  Limpar Tudo
                </button>
              </div>

              <ul id="lista-manual-preview" class="lista-manual-preview"></ul>
            </div>
          </div>

          <div id="area-delete" style="display: none; text-align: right; margin-top: -5px;">
            <button type="button" id="btn-excluir-curso"
              style="color: #ef4444; background: none; border: none; font-size: 0.75rem; cursor: pointer; text-decoration: underline;">
              Excluir este curso permanentemente
            </button>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-secondary-full btn-close-modal-curso">Cancelar</button>

        <button type="button" id="btn-salvar-curso" class="btn-save" disabled>
          Salvar Alterações
        </button>
      </div>
    </div>
  </div>

  <div id="modal-youtube" class="modal-overlay" style="display: none;"></div>
</body>
</html>


